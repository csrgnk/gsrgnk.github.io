<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<link rel="stylesheet" href="/admin/assets/admin.css">
</head>
<body>

<header>
  <h1>Dasabodha Admin Panel</h1>
</header>

<main>
  <!-- Login Form -->
  <div id="loginForm">
    <h2>Login</h2>
    <input type="text" id="login-username" placeholder="Username" required>
    <input type="password" id="login-password" placeholder="Password" required>
    <button onclick="login()">Login</button>
    <p><a href="#" onclick="showRegister()">Register</a> | <a href="#" onclick="showForgot()">Forgot Password?</a></p>
    <p id="login-error" style="color:red;"></p>
  </div>

  <!-- Register Form -->
  <div id="registerForm" style="display:none;">
    <h2>Register</h2>
    <input type="text" id="reg-username" placeholder="Username" required>
    <input type="password" id="reg-password" placeholder="Password" required>
    <input type="text" id="reg-name" placeholder="Full Name" required>
    <input type="text" id="reg-mobile" placeholder="Mobile Number" required>
    <button onclick="registerUser()">Register</button>
    <p><a href="#" onclick="showLogin()">Back to Login</a></p>
    <p id="reg-error" style="color:red;"></p>
  </div>

  <!-- Forgot Password Form -->
  <div id="forgotForm" style="display:none;">
    <h2>Forgot Password</h2>
    <input type="text" id="forgot-username" placeholder="Username" required>
    <input type="text" id="forgot-mobile" placeholder="Registered Mobile Number" required>
    <button onclick="forgotPassword()">Retrieve Password</button>
    <p><a href="#" onclick="showLogin()">Back to Login</a></p>
    <p id="forgot-error" style="color:red;"></p>
  </div>
</main>

<script>
let users = [];
fetch('/admin/users.json')
  .then(res => res.json())
  .then(data => users = data)
  .catch(err => console.error(err));

function showRegister() {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'block';
  document.getElementById('forgotForm').style.display = 'none';
}

function showLogin() {
  document.getElementById('loginForm').style.display = 'block';
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('forgotForm').style.display = 'none';
}

function showForgot() {
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registerForm').style.display = 'none';
  document.getElementById('forgotForm').style.display = 'block';
}

// Login
function login() {
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;
  const user = users.find(u => u.username === username && u.password === password);
  if(user){
    alert('Login Successful! Welcome ' + user.name);
    localStorage.setItem('adminUser', JSON.stringify(user));
  } else {
    document.getElementById('login-error').textContent = 'Invalid username or password!';
  }
}

// Register
function registerUser() {
  const username = document.getElementById('reg-username').value;
  const password = document.getElementById('reg-password').value;
  const name = document.getElementById('reg-name').value;
  const mobile = document.getElementById('reg-mobile').value;

  if(!username || !password || !name || !mobile){
    document.getElementById('reg-error').textContent = 'Please fill all fields!';
    return;
  }

  if(users.find(u => u.username === username)){
    document.getElementById('reg-error').textContent = 'Username already exists!';
    return;
  }

  const newUser = { username, password, name, mobile, role: 'subscriber' };
  users.push(newUser);
  alert('Registered successfully! Update users.json manually to save permanently.');
  console.log(users);
  showLogin();
}

// Forgot Password
function forgotPassword() {
  const username = document.getElementById('forgot-username').value;
  const mobile = document.getElementById('forgot-mobile').value;
  const user = users.find(u => u.username === username && u.mobile === mobile);
  if(user){
    alert('Your password is: ' + user.password);
  } else {
    document.getElementById('forgot-error').textContent = 'User not found or mobile mismatch!';
  }
}
</script>

</body>
</html>
